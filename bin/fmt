#!/usr/bin/env ruby
# frozen_string_literal: true

# == Dependencies ==
system("bundle", "install", "--quiet") ||
  abort("Failed to install Ruby dependencies")
system("yarn", "install", "--silent") ||
  abort("Failed to install Node dependencies")

# == Command ==
require "optparse"

options = {}

OptionParser.new do |opts|
  opts.banner = "Usage: bin/fmt [--fix] <targets...>"
  opts.on(
    "--fix",
    "Auto-format unformatted files",
  ) { |check| options[:check] = check }
end.parse!

mode = options[:fix] ? "--write" : "--check"

puts "== prettier =="
system("yarn", "--silent", "prettier", mode, ".")
